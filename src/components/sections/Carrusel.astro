---
const images = [
  {
    src: "https://wkayvtztiijqpvoxtcxj.supabase.co/storage/v1/object/public/media/site/1769636649979-xolmis-pyrope.webp",
    alt: "Xolmis pyrope",
  },
  {
    src: "https://wkayvtztiijqpvoxtcxj.supabase.co/storage/v1/object/public/media/site/1769636647220-anairetes-parulus.webp",
    alt: "Anairetes parulus",
  },
  {
    src: "https://wkayvtztiijqpvoxtcxj.supabase.co/storage/v1/object/public/media/site/1769636647799-colaptes-pitius.webp",
    alt: "Colaptes pitius",
  },
  {
    src: "https://wkayvtztiijqpvoxtcxj.supabase.co/storage/v1/object/public/media/site/1769636645192-albufera-garza-boyera.webp",
    alt: "Garza Boyera",
  },
  {
    src: "https://wkayvtztiijqpvoxtcxj.supabase.co/storage/v1/object/public/media/site/1769636649262-pelicano.webp",
    alt: "Pelícano",
  },
];

const heroImages = images;
---

<section class="hero">
  <div class="hero-overlay"></div>
  <div class="hero-text container">
    <!-- <p class="hero-kicker">Santuario de biodiversidad</p> -->
    <h1>Bienvenido al Humedal El Yali</h1>
    <p class="hero-subtitle">
      Un santuario natural ubicado en la Región de Valparaíso, clave para la
      conservación de aves, flora y ecosistemas costeros.
    </p>
  </div>

  <div class="carousel" aria-hidden="true">
    {
      heroImages.map((image, index) => (
        <img
          src={image.src}
          alt={image.alt}
          loading={index === 0 ? "eager" : "lazy"}
          fetchpriority={index === 0 ? "high" : "low"}
          decoding="async"
        />
      ))
    }
  </div>
</section>

<script>
  const heroSection = document.querySelector(".hero");
  const carouselImages = [...(heroSection?.querySelectorAll(".carousel img") ?? [])];
  let index = 0;

  function showNextImage() {
    carouselImages.forEach((img, i) => {
      if (img instanceof HTMLElement) {
        img.classList.toggle("is-visible", i === index);
      }
    });
    index = (index + 1) % carouselImages.length;
  }

  if (carouselImages.length > 0 && window.matchMedia("(max-width: 959px)").matches) {
    carouselImages.forEach((img, i) => img.classList.toggle("is-visible", i === 0));
    showNextImage();
    const intervalId = window.setInterval(showNextImage, 3500);

    document.addEventListener(
      "astro:before-swap",
      () => {
        window.clearInterval(intervalId);
      },
      { once: true },
    );
  }
</script>

<style>
  .hero {
    position: relative;
    min-height: 100vh;
    display: grid;
    place-items: center;
    overflow: hidden;
    color: #ffffff;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      120deg,
      rgba(12, 18, 14, 0.65),
      rgba(12, 18, 14, 0.15)
    );
    z-index: 1;
  }

  .hero-text {
    position: relative;
    z-index: 2;
    text-align: center;
    display: grid;
    gap: 1rem;
  }

  .hero-kicker {
    text-transform: uppercase;
    letter-spacing: 0.3rem;
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
  }

  .hero h1 {
    font-family: "Alegreya", serif;
    font-size: clamp(2.6rem, 5vw, 4.5rem);
    margin: 0;
    color: #ffffff;
  }

  .hero-subtitle {
    font-size: clamp(1.1rem, 2vw, 1.5rem);
    margin: 0;
    max-width: 600px;
    margin-inline: auto;
  }

  .carousel {
    position: absolute;
    inset: 0;
  }

  .carousel img {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }

  .carousel img:first-child {
    opacity: 1;
  }

  .carousel img.is-visible {
    opacity: 1;
  }

  @media (min-width: 960px) {
    .carousel {
      display: flex;
    }

    .carousel img {
      position: static;
      width: 0;
      flex-grow: 1;
      opacity: 0.6;
      transition:
        flex-grow 0.5s ease,
        opacity 0.5s ease;
    }

    .carousel img:hover {
      flex-grow: 3;
      opacity: 1;
      filter: contrast(120%);
    }
  }
</style>
